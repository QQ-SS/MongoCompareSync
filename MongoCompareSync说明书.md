# MongoDB比较同步工具 (MongoCompareSync) 说明书

## 1. 项目概述

MongoCompareSync是一款功能强大的MongoDB数据库比较和同步工具，使用Flutter框架开发，支持MacOS和Windows平台。该工具能够帮助用户轻松比较任意两个MongoDB数据库之间的集合数据，并根据比较结果执行精确的数据同步操作。

### 主要功能特点

- **直观的连接管理**：轻松添加、编辑、删除和测试MongoDB连接配置
- **可视化数据比较**：通过拖放操作创建集合绑定，直观展示数据差异
- **灵活的数据同步**：支持基于比较结果执行精确的增删改操作
- **自定义比较规则**：允许用户指定忽略特定字段或配置ID字段
- **跨平台支持**：同时支持MacOS和Windows操作系统
- **响应式设计**：适配不同屏幕尺寸，提供流畅的用户体验

## 2. 安装说明

### 系统要求

- **MacOS**：macOS 10.14或更高版本
- **Windows**：Windows 10或更高版本

### 安装步骤

1. 从项目的Release目录获取对应平台的安装包：
   - MacOS：`MongoDB比较同步工具.dmg`
   - Windows：（后续版本支持）

2. **MacOS安装**：
   - 双击`.dmg`文件打开安装界面
   - 将MongoDB比较同步工具拖拽到Applications文件夹中
   - 在Applications文件夹中找到并打开工具

3. **Windows安装**：
   - （后续版本支持）

## 3. 功能介绍

### 3.1 连接管理

连接管理模块允许用户创建和管理多个MongoDB连接配置。

**主要功能**：
- 添加新的MongoDB连接
- 编辑现有连接配置
- 删除不再需要的连接
- 测试连接的有效性
- 查看连接详细信息

**连接配置项**：
- 连接名称
- 主机地址
- 端口号
- 用户名（可选）
- 密码（可选）
- 认证数据库（可选）
- SSL连接（可选）

### 3.2 比较同步

比较同步是工具的核心功能，允许用户比较两个MongoDB数据库集合之间的数据差异并执行同步操作。

**主要功能**：
- 选择源连接和目标连接
- 通过拖放方式创建集合绑定
- 比较集合之间的数据差异
- 可视化展示差异结果
- 执行数据同步操作

**比较规则**：
- 自定义ID字段用于文档匹配
- 可配置忽略特定字段
- 支持多对多集合绑定

### 3.3 设置

设置模块允许用户自定义工具的行为和外观。

**主要设置项**：
- **外观**：
  - 主题模式（跟随系统/明亮模式/暗黑模式）

- **比较设置**：
  - 最大加载文档数量（防止性能问题）

- **其他设置**：
  - 启用日志记录
  - 查看日志文件

## 4. 使用教程

### 4.1 添加和管理MongoDB连接

1. **添加新连接**：
   - 点击左侧导航栏的"连接管理"
   - 点击"添加连接"按钮
   - 填写连接信息（名称、主机、端口等）
   - 点击"保存"按钮

2. **测试连接**：
   - 在连接列表中选择一个连接
   - 点击"测试连接"按钮
   - 查看连接测试结果

3. **编辑连接**：
   - 在连接列表中选择一个连接
   - 点击"编辑"按钮
   - 修改连接信息
   - 点击"保存"按钮

4. **删除连接**：
   - 在连接列表中选择一个连接
   - 点击"删除"按钮
   - 确认删除操作

### 4.2 比较和同步数据

1. **选择连接**：
   - 点击左侧导航栏的"比较同步"
   - 选择源连接和目标连接

2. **创建集合绑定**：
   - 在左侧源面板中展开数据库
   - 将需要比较的集合拖拽到右侧目标面板的对应集合上
   - 重复此操作可以创建多个集合绑定

3. **配置比较规则**：
   - 点击绑定列表中的设置图标
   - 配置ID字段和忽略字段
   - 保存规则配置

4. **执行数据比较**：
   - 点击"开始比较"按钮
   - 等待比较结果

5. **查看比较结果**：
   - 在比较结果界面查看数据差异
   - 支持按差异类型（新增、修改、删除）筛选

6. **执行数据同步**：
   - 选择需要同步的操作
   - 点击"执行同步"按钮
   - 等待同步完成

### 4.3 自定义设置

1. **修改主题**：
   - 点击左侧导航栏的"设置"
   - 在"外观"部分选择主题模式

2. **配置比较设置**：
   - 在"比较设置"部分设置最大加载文档数量

3. **管理日志**：
   - 切换"启用日志记录"开关
   - 点击"查看日志文件"查看详细日志

## 5. 技术架构

### 5.1 技术栈

- **框架**：Flutter 3.x
- **编程语言**：Dart
- **数据库驱动**：mongo_dart
- **状态管理**：Riverpod
- **数据序列化**：json_serializable
- **UI组件**：Material Design 3

### 5.2 项目结构

```
mongo_compare_sync/lib/
├── models/          # 数据模型定义
│   ├── connection.dart        # MongoDB连接模型
│   ├── collection.dart        # 集合模型
│   ├── document.dart          # 文档模型
│   ├── comparison_task.dart   # 比较任务模型
│   └── compare_rule.dart      # 比较规则模型
├── providers/       # Riverpod状态管理
│   ├── connection_provider.dart  # 连接管理状态
│   ├── compare_view_provider.dart # 比较视图状态
│   └── settings_provider.dart     # 设置状态
├── repositories/    # 数据存储抽象
│   ├── connection_repository.dart  # 连接配置存储
│   ├── compare_rule_repository.dart # 比较规则存储
│   └── settings_repository.dart     # 设置存储
├── screens/         # 界面组件
│   ├── home_screen.dart          # 主界面
│   ├── connection_screen.dart    # 连接管理界面
│   ├── compare_screen.dart       # 比较同步界面
│   └── settings_screen.dart      # 设置界面
├── services/        # 业务逻辑服务
│   ├── mongo_service.dart   # MongoDB交互服务
│   ├── log_service.dart     # 日志服务
│   └── error_service.dart   # 错误处理服务
├── widgets/         # 可复用组件
│   ├── connection_list.dart       # 连接列表组件
│   ├── connection_form.dart       # 连接表单组件
│   ├── drag_drop_compare_view.dart # 拖放比较组件
│   └── database_collection_panel.dart # 数据库集合面板
└── main.dart        # 应用程序入口
```

### 5.3 核心功能实现

#### 连接管理

使用`MongoConnection`模型表示连接配置，通过`ConnectionRepository`存储到本地文件系统。连接服务通过`mongo_dart`库实现与MongoDB的交互，支持连接测试和数据库列表获取。

#### 数据比较

通过`ComparisonTask`和`BindingConfig`模型定义比较任务和集合绑定。比较算法支持基于ID字段的文档匹配和自定义忽略字段配置，使用`mongo_dart`查询和比较文档数据。

#### 数据同步

同步功能基于比较结果执行精确的数据操作，包括：
- 插入新文档
- 更新已修改文档
- 删除不存在的文档
- 更新或删除特定字段

#### 界面设计

采用Material Design 3设计语言，提供现代化的用户界面。支持响应式布局，适配不同屏幕尺寸。界面组件采用模块化设计，确保代码复用和可维护性。

## 6. 常见问题解答

### Q1: 为什么连接测试失败？

A: 请检查以下几点：
- 主机地址和端口号是否正确
- 用户名和密码是否正确
- 认证数据库设置是否正确
- MongoDB服务是否正在运行
- 网络连接是否正常

### Q2: 为什么比较结果显示为空？

A: 可能的原因：
- 集合中没有数据
- 比较规则设置不正确
- 最大加载文档数量设置过小

### Q3: 如何提高比较性能？

A: 可以通过以下方式提高性能：
- 减少最大加载文档数量
- 增加忽略字段数量
- 确保ID字段有索引

### Q4: 同步操作会影响原数据吗？

A: 同步操作只会影响目标数据库，源数据库的数据保持不变。建议在执行重要同步操作前备份目标数据库。

## 7. 版本历史

### v1.0.0 (当前版本)

- 初始版本发布
- 支持MongoDB连接管理
- 实现集合比较和同步功能
- 支持自定义比较规则
- 跨平台支持MacOS和Windows
- 提供响应式用户界面

## 8. 联系方式

如有任何问题或建议，请通过以下方式联系：

- 项目地址：/Users/wxq/Source/MongoCompareSync
- 技术支持：（暂无）

---

**© 2025 MongoDB比较同步工具 (MongoCompareSync)**
